<div class="panel panel-default">
    <div class="panel-heading">
        <h4>预警规则列表</h4>
    </div>
    <div class="panel-body">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>预警条目</th>
                    <th>预警公众号范围</th>
                    <th>预警时限</th>
                    <th>通知方式</th>
                    <th>具体规则</th>
                </tr>
                </thead>
                <tbody>
                {% for rule in rules %}
                    <tr>
                        <td>{{ rule.id }}</td>
                        <td>{{ rule.account_name }} </td>
                        <td>{{ rule.duration }}天</td>
                        <td>{{ rule.notification }}</td>
                        <td>阅读增长量大于{{ rule.value }}条</td>
                    </tr>
                {% endfor %}
                </tbody>
                <script>
                    $(".official-account-link").click(function () {
                        loadContent($(this).data("url"), {});
                    });
                </script>
            </table>
        </div>
    </div>
</div>
<div class="row" style="margin-top:50px">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>创建预警规则</h4>
            </div>
            <div class="panel-body">
                <form id="rule-form" class="form form-vertical">
                    {% csrf_token %}


                    <div class="control-group">
                        <div class="row">
                            <div class="col-sm-6 form-group">
                                <label class="control-label" for="account-name-field">预警公众号账号</label>


                                <input id="account-name-field" type="text" name="account_name"
                                       list="account-name-list" class="form-control" placeholder="">
                                <span class="help-block">  不填写默认为所有公众号</span>
                                <datalist id="account-name-list">
                                    {% for id in wx_name %}
                                        <option value="{{ id }}">
                                    {% endfor %}
                                </datalist>
                            </div>
                            <div class="col-sm-6 form-group">
                                <label class="control-label" for="notification-field">通知方式</label>

                                <select id="notification-field" name="notification" class="form-control">
                                    <option value={{ NotificationOption.Email }}>邮件</option>
                                    <option value={{ NotificationOption.Message }}>站内通知</option>
                                </select>
                            </div>
                        </div>
                    </div>


                    <div class="control-group">
                        <label class="control-label" for="duration-field">预警时限</label>

                        <div class="row">
                            <div class="col-sm-6 form-group">
                                <input id="duration-field" name="duration" type="text" class="form-control"
                                       placeholder="" pattern="^[1-9]|\d{2,3}$" required>
                                <span class="help-block">1-999</span>
                            </div>
                            <div class="col-sm-1 form-group">
                                <h5>天</h5>
                            </div>
                        </div>

                    </div>


                    <div class="control-group">
                        <label class="control-label" for="target-field">预警规则</label>

                        <div class="row">
                            <div class="col-sm-6  form-group">
                                <select id="target-field" name="target" class="form-control">
                                    <option value={{ ForewarnTarget.ViewsTotal }}>阅读量</option>
                                    <option value={{ ForewarnTarget.LikesTotal }} disabled="disabled">点赞数</option>
                                </select>
                            </div>
                            <div class="col-sm-2  form-group">
                                <select name="" class="form-control">
                                    <option value="大于">大于</option>
                                    <option value="小于" disabled="disabled">小于</option>
                                </select>
                            </div>
                            <div class="col-sm-3  form-group">
                                <input id="value-field" name="value" type="text" class="form-control"
                                       placeholder="" pattern="^[1-9]|\d{2,4}$" required>
                                <!--<span class="help-block">1-5000</span>-->
                            </div>
                            <div class="col-sm-1  form-group">
                                <h5>条</h5>
                            </div>
                        </div>
                    </div>
                    <div class="control-group">
                        <label></label>

                        <div class="form-error-msg alert alert-danger alert-dismissible">
                            <div></div>
                            <button type="button" class="close" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                        </div>

                        <div class="controls">
                            <button id="form-submit" type="submit" name="method" value="submit"
                                    class="btn btn-primary">
                                创建
                            </button>
                        </div>
                    </div>
                </form>
                <script>
                    function checkLegal() {
                        var form = document.forms["rule-form"];
                        if (form['duration'].value < 1 || form['duration'].value > 365) {
                            alert('预警时限不合法');
                            return false;
                        }
                        if (form['value'].value < 1 || form['value'].value > 365) {
                            alert('阅读增长量不合法');
                            return false;
                        }
                        return true;
                    }

                    handleFormPost("#rule-form", "{% url 'api/submit_rule' %}", {
                        success_callback: function (data) {
                            alert("创建成功");
                            location.reload();
                        }
                    });


                </script>
            </div>
        </div>
    </div>
</div>
