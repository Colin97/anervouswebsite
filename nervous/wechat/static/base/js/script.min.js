function getCookie(e){var a=null;if(document.cookie&&""!=document.cookie)for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var o=jQuery.trim(t[n]);if(o.substring(0,e.length+1)==e+"="){a=decodeURIComponent(o.substring(e.length+1));break}}return a}function csrfSafeMethod(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)}function displayContent(e,a,t,n){var o;"undefined"==typeof t&&(t="#main-page"),o=$(t);var i=!0,s=!0;if("undefined"!=typeof a)for(var r in a)"anim"===r&&(i=a.anim),"scroll"===r&&(s=a.scroll);i&&o.css("opacity")>0?o.animate({opacity:0},250):o.css("opacity",0),o.queue(function(){o.html(e);var a=function(){o.css("height","auto"),"function"==typeof n&&n()};if(i){var r=0;if(o.children().each(function(){var e=$(this);"script"!==e.prop("tagName").toLowerCase()&&"none"!==e.css("display")&&(r+=e.outerHeight(!0))}),r=Math.max(r,removePx(o.css("min-height"))),s){var l=$(".main").css("padding-top"),c=parseInt(l.substr(0,l.indexOf("px")),10),d=o.position().top+("#main-page"===t?-c:c);$("html, body").stop(!0).delay(50).animate({"scroll-top":d})}o.delay(50).animate({opacity:1,height:r},a)}else a();$(this).dequeue()})}function loadContent(e,a,t,n,o){var i=$("#main-page"),s=!1,r=!0;if("undefined"!=typeof n&&(n.hasOwnProperty("replace")&&(s=n.replace),n.hasOwnProperty("anim")&&(r=n.anim)),i.stop(!0),r?i.animate({opacity:0,height:i.height()},250):i.css("height",i.height()),$(".left-column-item").removeClass("active"),"undefined"!=typeof t){var l=$(t);"undefined"!=typeof l&&$(l).addClass("active")}var c;c=setTimeout(function(){i.animate({opacity:50,height:100},250),i.html('            <div style="width: 100%; text-align: center;">                <span class="fa fa-spinner fa-pulse fa-4x"></span>            </div>')},1e3),$.ajax({type:"GET",url:e,data:a,success:function(a){clearTimeout(c),__manualStateChange=!0;var i={data:a,params:n,item:t,rand:Math.random(),callback:o};s?History.replaceState(i,document.title,e):History.pushState(i,document.title,e),initAjaxPage("#main-page"),loadComplete()},error:function(e,a,t){clearTimeout(c),displayContent('                <div class="alert alert-danger" role="alert">                    <strong>页面载入出错。</strong>                    错误信息：'+a+": "+e.status+" "+t+e.responseText.replace(/\n/g,"<br>")+"</div>")}})}function initAjaxPage(e){$(e).ready(function(){$(".ajax-link").unbind().click(function(){loadContent($(this).data("url"))})})}function loadContentOn(e,a,t,n,o){$(".main").css("height","auto");var i=e,s=!1;for(var r in n)"anim"===r&&(s=n.anim);s===!0&&i.animate({opacity:0,height:0},250);var l;l=setTimeout(function(){i.animate({opacity:30,height:100},250),"TBODY"==i.prop("tagName")?i.html('                <tr style="background-color: white;"><td colspan="10000">                    <p style="text-align: center">                        <span class="fa fa-spinner fa-pulse fa-2x"></span>                    </p>                </td></tr>'):i.html('                <div style="width: 100%; text-align: center;">                    <span class="fa fa-spinner fa-pulse fa-3x"></span>                </div>')},1e3),$.ajax({type:"GET",url:a,data:t,success:function(a){clearTimeout(l),displayContent(a,n,e,function(){"function"==typeof o&&o(),initAjaxPage(e),loadComplete()})},error:function(a,t,n){clearTimeout(l),displayContent('                <div class="alert alert-danger" role="alert">                    <strong>部件载入出错。</strong>                    错误信息：'+t+": "+a.status+" "+n+a.responseText.replace(/\n/g,"<br>")+"</div>",{anim:!0,scroll:!0},e)}})}function loadContentOfItem(e,a,t){loadContent($(e).data("url"),{},e,a,t)}function removePx(e){return"number"==typeof e?e:parseInt(e.substr(0,e.length-2))}function handleFormPost(e,a,t){var n=$(e);n.ready(function(){var e=n.find(".form-error-msg"),o=e.find("> div"),i=n.find(".form-group"),s=n.find(".form-method");n.find(".form-btn").click(function(){s.attr("value",$(this).attr("value"))}),i.not(i.has("span.help-block.with-errors")).append('<span class="help-block with-errors"></span>');var r=function(e){return"ok"===e.status?"#no_message#":e.hasOwnProperty("error_message")?e.error_message:"提交出错，请再次检查您填写的信息。"},l=$.noop,c=$.noop,d=r,u=$.noop;t.hasOwnProperty("success_callback")&&(l=t.success_callback),t.hasOwnProperty("error_callback")&&(c=t.error_callback),t.hasOwnProperty("success_msg")&&(d=t.success_msg),t.hasOwnProperty("before_submit")&&(u=t.before_submit),i.find("input, textarea").focus(function(){$(this).parent().removeClass("has-error"),e.fadeOut()}),n.submit(function(t){u(t),t.preventDefault(),i.removeClass("has-error"),$.ajax({type:"POST",url:a,data:n.serialize(),success:function(a){e.removeClass("alert-danger alert-success"),"ok"===a.status?e.addClass("alert-success"):e.addClass("alert-danger");var t=d(a);if(""===t&&(t=r),""!==t&&"#no_message#"!==t?(o.html(t),e.fadeIn()):e.fadeOut(),a.hasOwnProperty("error_messages")){var n=-1;for(var s in a.error_messages){var c=i.has("[name='"+s+"']");c.addClass("has-error"),c.find("span").html(a.error_messages[s]);var u=c.position().top;(-1===n||n>u)&&(n=u)}$("html, body").css("scroll-top")>n&&$("html, body").animate({"scroll-top":n},"fast")}l(a)},error:function(a,t,n){o.html("提交申请遇到错误："+t+": "+n),e.fadeIn(),c(a,t,n)}})})})}function loadComplete(){$(".badge").each(function(){var e=$(this),a=e.data("source");"undefined"!=typeof a&&$.ajax({type:"GET",url:a,success:function(a){e.html(a.toString())}})})}function animate(e,a){e.removeClass().addClass("animated "+a).one("animationend",function(){$(this).removeClass("animated "+a)})}function showConfirmModal(e,a,t){var n='    <div class="modal fade" id="confirm-modal" tabindex="-1" role="dialog" aria-labelledby="modal-label">        <div class="modal-dialog modal-sm" role="document">            <div class="modal-content">                <div class="modal-header">                    <h4 style="font-size: 19px;" class="modal-title" id="modal-label">                        <!-- title -->                    </h4>                </div>                <div class="modal-body" style="text-align: center;">                    <!-- message -->                </div>                <div class="modal-footer">                    <button id="modal-no-button" class="btn btn-danger" data-dismiss="modal">取消</button>                    <button id="modal-yes-button" class="btn btn-success" data-dismiss="modal">确认</button>                </div>            </div>        </div>    </div>';$("body").append(n);var o=$("#confirm-modal");o.find(".modal-header > h4").html(e),o.find(".modal-body").html(a),o.find("#modal-yes-button").click(t),o.on("hidden.bs.modal",function(){o.remove()}),o.modal(),resizeComponents(),loadComplete()}function showModal(e,a){$.ajax({type:"GET",url:e,success:function(e){$("body").append(e);var t=$("#"+a);t.on("hidden.bs.modal",function(){t.remove()}),t.modal(),resizeComponents(),loadComplete()},error:function(e,a,t){displayContent('                <div class="alert alert-danger" role="alert">                    <strong>部件载入出错。</strong>                    错误信息：'+a+": "+e.status+" "+t+e.responseText.replace(/\n/g,"<br>")+"</div>",{anim:!0,scroll:!0})}})}function callRepeated(e,a,t){var n=function(a){a>0&&(e(),setTimeout(function(){n(a-1)},t))};n(a)}function initLeftColumn(){var e=$("body"),a=$("#left-column"),t=$(".column-container");$("#left-column-toggle").click(function(t){if(t.preventDefault(),a.toggleClass("expanded"),a.hasClass("expanded")){var n=Math.max(e.height(),$(window).height()),o=$('<div id="left-column-backdrop" class="modal-backdrop fade visible-xs" style="z-index: 50; height: '+n+'px"></div>');e.append(o),setTimeout(function(){o.addClass("in")},100),$(o).click(function(){a.removeClass("expanded"),o.removeClass("in"),setTimeout(function(){o.remove()},500)})}else{var o=$("#left-column-backdrop");o.removeClass("in"),setTimeout(function(){o.remove()},500)}});var n="angle-double",o="fa-"+n+"-up",i="fa-"+n+"-down";a.find(".column-container > a").each(function(){$(this).append('<span class="fa '+o+' pull-right"></span>')}).click(function(){var e=$(this).find("span.fa"),a=$($(this).data("target"));setTimeout(function(){a.hasClass("in")?e.removeClass(i).addClass(o):e.removeClass(o).addClass(i)},500)}),a.ready(function(){var e=a.find(".scroll-edge-top"),n=e.find("span"),o=a.find(".scroll-edge-bottom"),i=o.find("span"),s=100;t.scroll(function(){var r=t.scrollTop(),l=t[0].scrollHeight,c=a.outerHeight(),d=s,u=s;r+s>l-c&&(d=l-c-r),s>r&&(u=r),i.css("opacity",d/s),n.css("opacity",u/s),0===d?o.stop(!0).fadeOut(150):o.stop(!0).fadeIn(150),0===u?e.stop(!0).fadeOut(150):e.stop(!0).fadeIn(150)}),e.css("opacity",""),o.css("opacity",""),e.fadeOut(0),o.fadeOut(0),t.scroll(),t.find("> a").click(function(){callRepeated(function(){$(window).scroll(),t.scroll()},40,10)}),e.click(function(){t.animate({"scroll-top":0},"fast")}),o.click(function(){t.animate({"scroll-top":t[0].scrollHeight-a.outerHeight()},"fast")})}),$(".left-column-item").click(function(){$(this).hasClass("active")||loadContentOfItem("#"+this.id)}),$(".fake-link-scroll").click(function(e){e.preventDefault(),$("html, body").animate({"scroll-top":0},"fast"),t.animate({"scroll-top":0},"fast")}),a.fixer({gap:removePx($(".main").css("padding-top"))})}function resizeComponents(){var e=$("#left-column"),a=e.outerHeight(!0);$("html, body").css("min-height",a),$("#main-page").css({"min-height":a}),$(".column-container").scroll();var t=$(".modal-backdrop");if("undefined"!=typeof t){var n=Math.max($("body").height(),$(window).height());t.height(n)}}function drawCharts(){var e=$(".tab-pane > object");if("undefined"!=typeof e){var a=$(".tab-pane.active > object"),t=a.height(),n=a.width();e.each(function(){var e=$(this);e.ready(function(){renderChart("#"+e.attr("id"),e.data("type"),e.data("json"),{width:n,height:t})})})}}var csrftoken=getCookie("csrftoken");$(function(){$.ajaxSetup({beforeSend:function(e,a){csrfSafeMethod(a.type)||this.crossDomain||e.setRequestHeader("X-CSRFToken",csrftoken)}}),$(document).ajaxError(function(e,a,t,n){"403"==a.status&&(window.location="/login")})});var __manualStateChange=!1;$(function(){$(window).unbind("statechange"),History.Adapter.bind(window,"statechange",function(){var e=History.getState(),a=$("#main-page");if($(window).width()<768){$("#left-column").removeClass("expanded");var t=$("#left-column-backdrop");t.removeClass("in"),setTimeout(function(){t.remove()},500)}if(__manualStateChange)__manualStateChange=!1,displayContent(e.data.data,e.data.params,void 0,function(){"function"==typeof e.data.callback&&e.data.callback(),initAjaxPage("#main-page"),loadComplete()});else{if(a.stop(!0).animate({opacity:0,height:a.height()},250),$(".left-column-item").removeClass("active"),0!=e.data.item){var n=$(e.data.item);"undefined"!=typeof n&&$(n).addClass("active")}displayContent(e.data.data,{},void 0,function(){"function"==typeof e.data.callback&&e.data.callback(),initAjaxPage("#main-page"),loadComplete()})}}),$(window).on("resize",resizeComponents);var e;$(window).on("resize",function(a){clearTimeout(e),e=setTimeout(function(){drawCharts()},250)}),initLeftColumn(),initAjaxPage(),loadComplete()});